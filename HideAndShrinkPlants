if _G.AutoHideShrinkPlantsPercent then return end
_G.AutoHideShrinkPlantsPercent = true

local FarmsRoot = workspace:WaitForChild("Farm")
local TINY_SIZE = Vector3.new(0.1, 0.1, 0.1)

local function shrinkAndHidePart(part)
    if part:IsA("BasePart") then
        part.Size = TINY_SIZE
        part.Transparency = 1
        part.CanCollide = false
    end
end

local function processPlant(plant)
    for _, obj in ipairs(plant:GetDescendants()) do
        shrinkAndHidePart(obj)
    end
end

local function splitIntoThree(list)
    local total = #list
    local batchSize = math.ceil(total / 3)
    return {
        { unpack(list, 1, batchSize) },
        { unpack(list, batchSize + 1, batchSize * 2) },
        { unpack(list, batchSize * 2 + 1, total) },
    }
end

local function getPlantsToFix(plantsFolder)
    local needing = {}
    for _, plant in ipairs(plantsFolder:GetChildren()) do
        for _, obj in ipairs(plant:GetDescendants()) do
            if obj:IsA("BasePart") then
                if obj.Transparency < 1 or obj.Size ~= TINY_SIZE then
                    table.insert(needing, plant)
                    break
                end
            end
        end
    end
    return needing
end

local function handleFarm(farmFolder)
    local important = farmFolder:FindFirstChild("Important")
    if not important then return end
    local plantsFolder = important:FindFirstChild("Plants_Physical")
    if not plantsFolder then return end
    for _, plant in ipairs(plantsFolder:GetChildren()) do
        processPlant(plant)
    end
    plantsFolder.ChildAdded:Connect(function(newPlant)
        task.wait(0.1)
        processPlant(newPlant)
    end)

    task.spawn(function()
        while task.wait(5) do
            local needFix = getPlantsToFix(plantsFolder)
            if #needFix > 0 then
                local batches = splitIntoThree(needFix)
                for i = 1, #batches do
                    for _, plant in ipairs(batches[i]) do
                        processPlant(plant)
                    end
                    task.wait(0.5)
                end
            end
        end
    end)
end

for _, farm in ipairs(FarmsRoot:GetChildren()) do
    if farm:IsA("Folder") and farm.Name == "Farm" then
        handleFarm(farm)
    end
end
